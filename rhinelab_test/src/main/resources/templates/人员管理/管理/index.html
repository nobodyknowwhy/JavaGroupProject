<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<link rel="icon" type="image/jpeg" th:href="@{/img/rahinelab_logo.png}" sizes="32x32">
<head>
  <title>个人界面</title>
  <script>
        function myFunction(){
        var x;
        var r=confirm("是否确认退出");
        if (r==true){
           window.location.href = "../index.php";
        }
        }
    </script>
  <style>
    body {
      background-color: #ffe6e6;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      color: #588c7e;
      font-family: monospace;
      font-size: 25px;
      text-align: left;
      margin: 0 auto;
      background-color: #f2f2f2;
    }
    td {
      display: block;
      text-align: left;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    .personal-info {
      border: none;
      padding: 10px;
      text-align: center;
    }
    .button-row {
      background-color: #fff2f2;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }
    .button-row button {
      background-color: blue;
      color: white;
      border: none;
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    input[type="button"] {
        width: 100px;
        height: 30px;
        font-size: 16px;
        background-color: #007FFF;
        color: #fff;
        border: none;
        border-radius: 5px;
        margin-top: 20px;
        cursor: pointer;
        position: absolute;
        top: 10px;
        left: 10px;
    }
    input[type="button"]:hover {
        background-color: #0066CC;
    }
  </style>
</head>
<body>
  <div class="personal-info">
  <input type="button" class="button" onclick="myFunction()" value="退出登录" >
    <?php
      $conn = mysqli_connect("localhost", "root", "Zz15987324860", "rhinelab");
      if ($conn-> connect_error) {
        die("Connection failed:". $conn-> connect_error);
      }
      $bianhao = $_SESSION['id'];
      $password = $_SESSION['password'];
      $sql = "SELECT 员工编号, 姓名, 照片, 性别, 民族, 生日, 政治面貌, 籍贯, 手机号码, 邮箱, 入职时间, 部门编号, 状态 from 员工 where 员工编号=$bianhao AND 密码=$password";
      $result = $conn-> query($sql);
      if ($result-> num_rows > 0) {
        while ($row = $result-> fetch_assoc()) {
          $bianhao = $row["员工编号"];
          echo "<h2 style='text-align: center;'>个人信息</h2>";
          echo "<img src='../干员/LinImage/". $row["照片"] . "' alt='Description of image'>";
          echo "<h3 style='text-align: center;'>". $row["姓名"]."</h3>";
          echo "<div style='background-color: #f2f2f2;'>";
          echo "<div class='button-row'>";
          echo "<button onclick='signIn()'>签到</button>";
          echo "<span id='signInTime'></span>";
          echo "<button onclick='signOut()'>签退</button>";
          echo "<span id='signOutTime'></span>";
          echo "<button onclick='apply()'>申请</button>";
          echo "<button onclick='goToControl()'>管理</button>";
          echo "</div>";
          echo "</div>";
          echo "<table>";
          echo "<tr><td>员工编号: ". $row["员工编号"]."</td><td>姓名: ". $row["姓名"]."</td><td>性别: ". $row["性别"]."</td><td>民族: ". $row["民族"]."</td><td>生日: ". $row["生日"]."</td><td>政治面貌: ". $row["政治面貌"]."</td><td>籍贯: ". $row["籍贯"]."</td><td>手机号码: ". $row["手机号码"]."</td><td>邮箱: ". $row["邮箱"]."</td><td>入职时间: ". $row["入职时间"]."</td><td>部门编号: ". $row["部门编号"]."</td><td>状态: ". $row["状态"]."</td><td id='working-hours'></td></tr>";
          echo "</table>";
        }
      }
      else {
        echo "0 result";
      }
      $conn-> close();
    ?>
  </div>
  <script>
    function signIn() {
      var signInTime = new Date();
      document.getElementById("signInTime").innerHTML = "签到时间：" + signInTime.toLocaleString();
    }

    function signOut() {
      var signOutTime = new Date();
      document.getElementById("signOutTime").innerHTML = "签退时间：" + signOutTime.toLocaleString();
      var signInTime = document.getElementById("signInTime").innerHTML;
      if (signInTime) {
        signInTime = signInTime.replace("签到时间：", "");
        // Calculate working hours
        var signInTimestamp = new Date(signInTime).getTime();
        var signOutTimestamp = signOutTime.getTime();
        var workingHours = (signOutTimestamp - signInTimestamp) / (1000 * 60 * 60);
        document.getElementById("working-hours").innerHTML = "工时：" + workingHours.toFixed(2) + "小时";

        var xhttp = new XMLHttpRequest();
        xhttp.open("POST", "save_data.php", true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send("signInTime=" + signInTime + "&signOutTime=" + signOutTime.toLocaleString() + "&employeeId=<?php echo $bianhao ?>" + "&workingHours=" + workingHours.toFixed(2));
      }
    }

    function apply() {
     window.location.href = "shenqing.php";
    }

    function goToControl() {
      var password = prompt("请输入管理员密码：");
      if (password == "password") {
        location.href = "control.php";
      } else {
        alert("密码错误，无法进入管理界面。");
      }
    }

  </script>
</body>
</html>