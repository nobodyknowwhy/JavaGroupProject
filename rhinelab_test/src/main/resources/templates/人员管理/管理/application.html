<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<link rel="icon" type="image/jpeg" th:href="@{/img/rahinelab_logo.png}" sizes="32x32">
<head>
  <title>员工调岗申请</title>
  <meta charset="UTF-8">
  <style>
    body {
        text-align: center;
        background-image: url(/img/image/ebc.png);/* 主要图片 */
        background-repeat:no-repeat;
        opacity: 0.8;
        background-size:100%;
        font-family: 'Times New Roman', Times, serif;
        background-attachment:fixed;
    }

    table {
      background-color: #e6f2ff;
      margin: 0 auto;
      text-align: center;
    }

    td,
    th {
      padding: 5px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <h1>员工调岗申请 <button onclick="goToControl2()"> <a>返回</a></button></h1>
  <table>
    <tr>
      <th>员工编号</th>
      <th>姓名</th>
      <th>原部门</th>
      <th>新部门</th>
      <th>原工资</th>
      <th>新工资</th>
      <th>申请理由</th>
      <th>操作</th>
    </tr>

       <tr th:each="apply : ${applyinfos}">
           <form action="/applyUpdate" method='post'>
           <td><span th:text="${apply.employeeNum}"></span></td>
           <td><span th:text="${apply.name}"></span></td>
           <td><span th:text="${apply.origionSection}"></span></td>
           <td><span th:text="${apply.newSection}"></span></td>
           <td><span th:text="${apply.origionSalary}"></span></td>
           <td><span th:text="${apply.newSalary}"></span></td>
           <td><span th:text="${apply.applyReason}"></span></td>
           <td><span th:text="${apply.status}"></span></td>
           <td>
               <input type='hidden' name='applyNum' th:value='${apply.applyNum}'>
               <input type='hidden' name='employeeNum' th:value="${apply.employeeNum}">
               <input type='hidden' name='newSection' th:value="${apply.newSection}" >
               <input type='hidden' name='newSalary' th:value="${apply.newSalary}">
               <input type='submit' name='identity' value='同意'><input type='submit' name='identity' value='拒绝'>
           </td>
           </form>
       </tr>

<!--        // Execute the query and check if it was successful-->
<!--        if ($conn->query($sql) === TRUE) {-->
<!--          $sqlx = "SELECT * FROM `员工` WHERE `员工编号` = '$employee_id'";-->
<!--          echo $sqlx;-->
<!--          $result = $conn->query($sqlx);-->
<!--          $row = $result->fetch_assoc(); // 获取查询结果的第一行数据-->
<!--          $email = $row['邮箱']; // 输出查询结果中的邮箱地址-->
<!--          $name = $row['姓名'];-->
<!--          try {-->
<!--            $mail = new PHPMailer();-->
<!--            $mail->isSMTP();-->
<!--            $mail->CharSet = "UTF-8";-->
<!--            $mail->Host = "smtp.qq.com";-->
<!--            $mail->SMTPAuth = true;-->
<!--            $mail->Username = "2511950954@qq.com";-->
<!--            $mail->Password = "bnsybpgpjtdxdidi";-->
<!--            $mail->From = "2511950954@qq.com";-->
<!--            $mail->FromName = "Rhine Lab";-->
<!--            $mail->addAddress("$email");-->
<!--            $mail->addReplyTo("2511950954@qq.com");-->
<!--            $mail->isHTML(true);-->
<!--            $mail->Subject = 'Your Employee Information Update is Complete';-->

<!--            $mail->Body = nl2br("-->
<!--            Dear $name,-->
<!--            &nbsp&nbsp&nbsp&nbsp Thank you for submitting your request for a change in your employee information. We have received your application and have completed the necessary updates to your information.  You will see these changes reflected in your paystub after the next pay period.-->
<!--            &nbsp&nbsp&nbsp&nbspIf you have any questions regarding your new department or salary, please do not hesitate to contact us. We are happy to provide assistance and support.-->
<!--            &nbsp&nbsp&nbsp&nbspThank you once again for your support and cooperation with our company.-->
<!--            Best regards,-->
<!--          ZeJia Lin-->
<!--          RHINE LAB-->
<!--          ");-->
<!--            $mail->AltBody = "注意该邮件附有附件！";-->
<!--            if ($mail->send()) {-->
<!--              // 邮件发送成功-->
<!--              echo "邮件发送成功！";-->
<!--            } else {-->
<!--              // 邮件发送失败-->
<!--              echo "邮件发送失败！";-->
<!--              echo "<p>错误：" . $mail->ErrorInfo;-->
<!--            }-->
<!--          } catch (Exception $e) {-->
<!--            echo '邮件发送失败！';-->
<!--            echo "<p>错误：" . $mail->ErrorInfo;-->
<!--          }-->

<!--          echo "<script>alert('员工申请已同意。员工信息已更新。');</script>";-->
<!--          echo "<script>window.location = 'control.php';</script>";-->
<!--        } else {-->
<!--          echo "<script>alert('员工申请已同意，但员工信息更新失败。请手动更新。');</script>";-->
<!--        }-->
<!--      } else {-->
<!--        echo "<script>alert('操作失败。');</script>";-->
<!--      }-->
<!--    } else if (isset($_POST['reject'])) {-->
<!--      $transfer_id = $_POST['transfer_id'];-->

  </table>
  <script>
      function goToControl2() {
          window.location.href = "/control";
      }
  </script>
</body>

</html>